---
slug: cookie
title: 学习cookie的基本使用
authors: bing
tags: [cookie]
---

## 跨站和跨域

### 跨站

只要顶级域名和二级域名相同就可以认为是同站

例如：a.com 和a.a.com就是同站，但是b.com和a.com就算是跨站了

### 跨域

只要两个url的协议，域名和端口号其中有一个或多个不同，那么就是为跨域了

下面是一些跨域的示例：
1. 协议不同：http://a.com:3000和https://a.com:3000
2. 域名不同：http://a.com:3000和http://b.com:3000
3. 端口不同：http://a.com:3000和http://a.com:9000

在浏览器中对跨域的判断要比跨站的判断严格很多

## 在浏览器中对cookie的操作

### 新增cookie

cookie就是一个字符串，但是它有一些规则，这个字符串大致是这个样子的：

'key1=value1;attribute1=value2;atrribute2=value3;'

```js
document.cookie = 'myname=bing'
```

### 修改cookie

它和新增操作是相同的，如果已经存在相同key的cookie，那么就变更这个cookie的值，如果不存在，那么就新增cookie

```js
// 以前的值bing --> 现在的值moubing
document.cookie = 'myname=moubing'
```

### 删除cookie

删除cookie只需要只需要指定key，然后加上配置max-age的值为负数

```js
document.cookie = 'myname=;max-age=-1'
```

### 快速获取所有cookie的值

```js
document.cookie.split(';').reduce((acc,cur) => {
    const [key, value] = cur.split('=')
    acc[key] = value
    return acc
}, {})
```

## cookie属性

### domain

domain里面不携带协议和端口，它的取值为：
    - a.com --> 只作用于当前域名，不包含当前域名的子域名
    - .a.com --> 作用域当前域名以及其子域名

举个例子：如果在a.com定义了如下两个cookie

```js
// 如果不设置domain，那么就取默认值a.com
// 设置domain的值为a.com和设置值为.a.com的效果相同
document.cookie = 'firstname=mou;'
documnet.cookie = 'lastname=bing;domain=a.com'
// document.cookie = 'lastname=bing;domain=.a.com'
```

然后，在a.com中，你能看到这两个cookie，在sub.a.com你只能看到lastname这个cookie

:::note
在子域名中设置的domain为.a.com的cookie，在整个a.com以及其所有子域名中都可以被访问
:::

### path

```js
// 这个cookie在路由/a以及其子路由可以被访问
document.cookie = 'myname=moubing;path=/a'
```

### expires和max-age

- expires --> 在指定时间失效
- max-age --> 在多少秒后失效

如果这两个属性都设置了，那么max-age的优先级更高

如果设置expires为以前的日期和设置max-age为0或负值都表示删除这个cookie

:::note
如果一个cookie既没有设置expires又没有设置max-age，那么这个cookie就是一个会话cookie，当浏览器关闭时，这个cookie就没了
:::

### httponly

httponly是和cookie的安全性紧密相关的属性，它只能是由服务端通过相应标头中的set-cookie种在浏览器上

拥有httponly的cookie不能被javascript操作

### secure

secure这个属性用来告诉浏览器这个cookie只能用在https协议传输上。

### samesite

samesite属性有三个取值：
- None --> 不论是否跨站都发送cookie
- Strict --> 跨站不带cookie
- Lax(默认值) --> 部分情况下携带cookie

:::note
samesite只有在跨站请求的时候才会起作用
:::